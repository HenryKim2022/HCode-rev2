<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Aplikasi Cetak Foto Gratis | Print Foto tanpa Photoshop dan Microsoft Word</title>
    <meta name="description"
        content="Aplikasi cetak foto yang memudahkan anda menata pas foto sebelum dicetak atau print tanpa perlu install Photoshop dan Microsoft Word.">
    <meta name="keywords" content="aplikasi cetak foto, aplikasi print foto">
    <meta property="og:title" content="Aplikasi Cetak Foto Gratis | Print Foto tanpa Photoshop dan Microsoft Word">
    <meta property="og:type" content="website">
    <meta property="og:description"
        content="Aplikasi cetak foto yang memudahkan anda menata pas foto sebelum dicetak atau print tanpa perlu install Photoshop dan Microsoft Word.">
    <meta property="og:site_name" content="Jasa Pembuatan Website Naevaweb">
    <meta property="og:locale" content="id_ID">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Aplikasi Cetak Foto Gratis | Print Foto tanpa Photoshop dan Microsoft Word">
    <meta name="twitter:description"
        content="Aplikasi cetak foto yang memudahkan anda menata pas foto sebelum dicetak atau print tanpa perlu install Photoshop dan Microsoft Word.">
    <meta property="og:image:width" content="768">
    <meta property="og:image:height" content="768">
    <meta property="og:image:alt" content="Aplikasi Cetak Foto Gratis | Print Foto tanpa Photoshop dan Microsoft Word">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Naevaweb.com">





    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"
        type="text/css">
    <!-- Optional custom CSS -->
    <link href="custom/jspdf/naevaweb.com-builder.css" rel="stylesheet" type="text/css">
    <!-- jQuery Full Version -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap Bundle with Popper.js -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"
        type="text/css">




    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>


    <script src="https://naevaweb.com/userfiles/asset/vendors/naevaweb/basic.js"></script>
    <link rel="alternate" type="application/rss+xml"
        title="Aplikasi Cetak Foto Gratis | Print Foto tanpa Photoshop dan Microsoft Word"
        href="https://naevaweb.com/feed/">

</head>

<body data-spy="scroll" data-target="#scrollspy" data-offset="0">
    <div id="preloader" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <a id="top" class="clear"></a>

    <style>
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #drop-area {
            border: 2px dashed #ccc !important;
            text-align: center;
            padding: 50px;
            color: #999 !important;
            cursor: pointer !important;
        }

        #drop-area:hover {
            background: #f0f0f0 !important;
        }
    </style>
    <script>
        $(function () {
            $(document).scroll(function () {
                var $nav = $("#mynavbar");
                var bodytop = $(this).scrollTop();
                var bodymargin = 120;
                var navheight = $nav.height();
                var navtop = bodymargin - bodytop;
                if (navtop < 0) navtop = 0;
                $nav.toggleClass('navbar-scrolled', navheight < bodytop);
                $("#topwrapnav").toggleClass('d-none', navheight < bodytop);
            });
        });


        $('.dropdown-menu .dropdown-toggle').on('click', function () {

            var $el = $(this);
            var $parent = $el.offsetParent(".dropdown-menu");

            if (!$el.next().hasClass("show")) {
                $el.parents('.dropdown-menu').first().find(".show").removeClass("show");
            }
            $el.next(".dropdown-menu").toggleClass("show").parent("li").toggleClass("show");

            $el.parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown", function () {
                $(".dropdown-menu .show").removeClass("show");
            });

            if (!$parent.parent().hasClass("navbar-nav")) {
                $el.next().css({
                    "top": $el[0].offsetTop,
                    "left": $parent.outerWidth()
                });
            }

            return false;
        });
    </script>
    <style>
        #drop-area.highlight {
            border-color: #555555;
        }

        #fileElem {
            display: none;
        }

        .defaultwhatsapp {
            display: none !important;
        }
    </style>
    </div>
    </div>
    </div>
    <div class="px-3 py-3 bg-white border d-flex justify-content-between"></div>
    </div>



    <div id="preview-pane"></div>

    <div class="container-fluid">
        <div class="row justify-content-center pb-5">
            <div class="col-xl-4 col-lg-4 col-md-5 mb-3" style="display: block;" id="previewPDF">
                <div class="px-2 py-1 small bg-dark text-white">PREVIEW</div>
                <div class="bg-secondary border text-center py-2" style="height:350px; overflow: auto;">
                    <div style="width:210px;" class="mx-auto">
                        <div class="bg-white mb-3 shadow" style="height: 297px; padding:0px;">
                            <div class="border position-relative" style="height: 297px;">
                                <img src="" width="178" height="undefined"
                                    style="position:absolute; top: 0px; left: 0px;">
                            </div>
                        </div>
                        <div class="bg-white mb-3 shadow" style="height: 297px; padding:0px;">
                            <div class="border position-relative" style="height: 297px;">

                            </div>
                        </div>

                        <div class="bg-white mb-3 shadow" style="height: 297px; padding:0px;">
                            <div class="border position-relative" style="height: 297px;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-3 py-3 bg-white border d-flex justify-content-between">
                    <div>
                        <button type="button" class="btn btn-success d-none d-lg-inline-block"
                            onclick="downloadPDF('print')">Print</button> <button type="button"
                            class="btn btn-success d-inline-block d-lg-none"
                            onclick="modalSBoxAlert('<strong>Maaf browser ini tidak mendukung fitur print.</strong> <div>Silahkan download sebagai PDF lalu print menggunakan aplikasi atau perangkat lain.</div>')">Print</button>
                        <button type="button" class="btn btn-success" onclick="downloadPDF('download')">Download
                            PDF</button>
                    </div>
                    <div>
                        <button type="button" class="btn btn-success" href="javascript:void(0)" data-toggle="modal"
                            data-target="#gtModal"><span class="fa fa-cog"></span><span class="d-none d-lg-inline">
                                Setting</span></button>
                        <div></div>
                    </div>
                </div>
            </div>
            <div class="drop-area-outter col-xl-7 col-lg-8 col-md-7">
                <div id="drop-area" class="drop-area border rounded bg-white p-4 text-center mb-3 highlight">
                    <p style="font-size:1.125em;" class="pt-2">Drag banyak foto yang akan dicetak sekaligus.</p>
                    <input type="file" id="fileElem" multiple="" accept="image/*" onchange="handleFiles(this.files)">
                    <label class="btn btn-primary" for="fileElem"><i class="fa fa-upload mr-2"></i> Upload Foto</label>
                </div>
                <div class="px-2 px-md-0">
                    <div id="img-settings" class="row justify-content-start align-items-start no-gutters">

                    </div>
                </div>

            </div>
        </div>
        <a id="imageDownload"></a>
    </div>



    <!--
    <div class="text-center pt-2 pb-4">
        <a href="https://api.whatsapp.com/send?phone=6281215787470&text=Halo+Naevaweb+,+saya+punya+ide+untuk+aplikasi+cetak+foto:&source=&data=" class="btn btn-success">Kirim Saran / Request Fitur</a>
    </div>
    -->



    <div class="modal fade" id="cropModal" tabindex="-1" role="dialog" aria-labelledby="cropModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cropModalLabel">Crop Image</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                    <div class="img-container">
                        <img id="cropImage" src="" alt="Image to crop" style="max-width: 100%;">
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="d-flex align-items-center w-100">
                        <label for="aspectRatioSelect" class="mr-2">Aspect Ratio:</label>
                        <select id="aspectRatioSelect" class="form-control mr-auto">
                            <!-- <option value="NaN">Free</option>
                            <option value="1">Persegi</option>
                            <option value="0.6667">Pas Foto 2x3</option>
                            <option value="0.75">Pas Foto 3x4</option>
                            <option value="0.6667">Pas Foto 4x6</option>
                            <option value="1.91">Facebook Cover</option>
                            <option value="1.5">Foto 3R</option>
                            <option value="1.5">Foto 5R</option>
                            <option value="1.25">Foto 8R</option>
                            <option value="1.25">Foto 10R</option>
                            <option value="3">3x1</option>
                            <option value="0.5">1x2</option>
                            <option value="0.3333">1x3</option>
                            <option value="1">Foto Profile Lingkaran</option>
                            <option value="1.91">Facebook Post</option>
                            <option value="0.707">Kertas A4</option>
                            <option value="0.707">Kertas A5</option>
                            <option value="1.7778">16x9</option>
                            <option value="0.5625">9x16</option> -->
                        </select>
                        <button type="button" class="btn btn-success ml-2" id="confirmCrop">
                            <i class="fas fa-check"></i>
                        </button>
                        <button type="button" class="btn btn-danger ml-2" data-dismiss="modal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    </div>
    <div id="jsContainer">
        <script src="custom/jspdf/jspdf.umd.min.js"></script>
        <script>window.jsPDF = window.jspdf.jsPDF;</script>

        <script>
            $(document).ready(function () {
                gSetup();
            });

            let dropArea = document.getElementById("drop-area");
            let dropAreaOutter = document.querySelector(".drop-area-outter");


            let files;
            let amountDefault = 4;
            let setting;
            let photoID = 0;
            let photos = {};
            let paperWidth = 210;
            let paperHeight = 297;
            let paperRatio = 1.51176;

            // Generate number options for amount dropdown
            let numberOptions = '';
            for (let i = 1; i <= 50; i++) {
                let selected = (i == amountDefault) ? 'selected="selected"' : '';
                numberOptions += '<option value="' + i + '" ' + selected + '>' + i + ' buah</option>';
            }

            // Photo dimensions mapping
            let photoHeights = {
                "20": 40,    // Pas Foto 1x2
                "10": 30,    // Pas Foto 1x3
                "120": 40,   // Pas Foto 3x1
                "21.6": 27.9, // Pas Foto 2x3
                "27.9": 38.1, // Pas Foto 3x4
                "38.1": 55.9, // Pas Foto 4x6
                "90": 160,   // Pas Foto 9x16
                "160": 90,   // Pas Foto 16x9
                "63.5": 88.9, // Foto 2R
                "89": 127,   // Foto 3R
                "102": 152,  // Foto 4R
                "127": 178,  // Foto 5R
                "203": 254,  // Foto 8R
                "254": 305,  // Foto 10R
                "594": 420,  // Kertas A2
                "420": 297,  // Kertas A3
                "193": 280,  // Kertas A4
                "297": 210,  // Kertas A4 Landscape
                "148": 210,  // Kertas A5
                "100": 52,   // Facebook Cover
                "120": 63    // Facebook Post
            };

            function showPreloader() {
                document.getElementById('preloader').style.display = 'flex';
            }

            function hidePreloader() {
                setTimeout(() => {
                    document.getElementById('preloader').style.display = 'none';
                }, 1000); // Simulasi waktu pemrosesan

            }

            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
                dropAreaOutter.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            // Highlight drop area on drag over
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
                dropAreaOutter.addEventListener(eventName, highlight, false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
                dropAreaOutter.addEventListener(eventName, unhighlight, false);
            });

            // Handle dropped files
            dropArea.addEventListener('drop', handleDrop, false);
            dropAreaOutter.addEventListener('drop', handleDrop, false);

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function highlight(e) {
                dropArea.classList.add('highlight');
            }

            function unhighlight(e) {
                dropArea.classList.remove('highlight');
            }

            function handleDrop(e) {
                let dt = e.dataTransfer;
                files = dt.files;
                handleFiles(files);
            }

            // function handleFiles(files) {
            //     showPreloader();
            //     files = [...files];
            //     files.forEach(previewFile);
            //     $('#fileElem').val('');
            //     hidePreloader();
            // }


            // Tambahkan fungsi untuk mengompres gambar
            function compressImage(file, maxSizeMB = 10, quality = 0.8) {
                return new Promise((resolve, reject) => {
                    if (file.size / 1024 / 1024 <= maxSizeMB) {
                        resolve(file); // Jika ukuran file <= 10MB, tidak perlu dikompres
                        return;
                    }

                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = function (event) {
                        const img = new Image();
                        img.src = event.target.result;
                        img.onload = function () {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');

                            // Set ukuran canvas sesuai dengan gambar asli
                            canvas.width = img.width;
                            canvas.height = img.height;

                            // Gambar ulang gambar ke dalam canvas
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                            // Kompres gambar ke format JPEG dengan kualitas tertentu
                            canvas.toBlob(
                                (blob) => {
                                    if (blob) {
                                        const compressedFile = new File([blob], file.name, { type: 'image/jpeg' });
                                        resolve(compressedFile);
                                    } else {
                                        reject(new Error('Gagal mengompres gambar.'));
                                    }
                                },
                                'image/jpeg',
                                Math.min(Math.max(quality, 0.1), 1) // Pastikan kualitas berada di antara 0.1 dan 1
                            );
                        };
                    };
                    reader.onerror = function (error) {
                        reject(error);
                    };
                });
            }


            // Modifikasi fungsi handleFiles untuk memproses kompresi
            // function handleFiles(files) {
            //     showPreloader();
            //     files = [...files];
            //     const compressedFilesPromises = files.map((file) => compressImage(file));
            //     Promise.all(compressedFilesPromises)
            //         .then((compressedFiles) => {
            //             compressedFiles.forEach(previewFile);
            //             $('#fileElem').val('');
            //             hidePreloader();
            //         })
            //         .catch((error) => {
            //             console.error('Error saat mengompres gambar:', error);
            //             hidePreloader();
            //         });
            // }



            function handleFiles(files) {
                showPreloader();
                files = [...files];
                if (setting.compress) {
                    const compressedFilesPromises = files.map((file) => compressImage(file, 10, setting.quality)); // Gunakan setting.quality
                    Promise.all(compressedFilesPromises)
                        .then((compressedFiles) => {
                            compressedFiles.forEach(previewFile);
                            $('#fileElem').val('');
                            hidePreloader();
                        })
                        .catch((error) => {
                            console.error('Error saat mengompres gambar:', error);
                            hidePreloader();
                        });
                } else {
                    files.forEach(previewFile); // Langsung tampilkan gambar tanpa kompresi
                    $('#fileElem').val('');
                    hidePreloader();
                }
            }


            function previewFile(file) {
                photoID++;
                let photoName = 'file' + photoID;
                let reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onloadend = function () {
                    let maxWidth = 38.1;
                    let width, height, ratio;
                    let image = new Image();
                    image.src = reader.result;
                    image.onload = function () {
                        width = image.width;
                        height = image.height;
                        ratio = height / width;
                        if (ratio > paperRatio) {
                            maxWidth = Math.floor((paperWidth - 2 * setting['margin']) * (paperRatio / ratio));
                        }
                        photos[photoName] = {
                            data: reader.result, // Cropped or current image data
                            originalData: reader.result, // Store the original image data
                            amount: amountDefault,
                            ratio: ratio,
                            width: maxWidth,
                            maxWidth: maxWidth,
                            orientation: 'portrait'
                        };
                        const container = document.createElement('div');
                        container.className = 'col-lg-3 col-md-4 col-6 mb-3';
                        container.id = photoName;
                        const card = document.createElement('div');
                        card.className = 'bg-white border text-center';
                        const topWrapper = document.createElement('div');
                        topWrapper.className = 'position-relative';
                        const buttonBar = document.createElement('div');
                        buttonBar.className = 'position-absolute pt-2';
                        buttonBar.style.right = '8px';

                        // const zoomBtn = document.createElement('button');
                        // zoomBtn.type = 'button';
                        // zoomBtn.className = 'btn btn-sm btn-primary';
                        // zoomBtn.title = 'Perbesar Gambar Halaman';
                        // zoomBtn.onclick = () => zoomImage(photoName);
                        // zoomBtn.innerHTML = '<i class="fas fa-expand"></i>';

                        const dupBtn = document.createElement('button');
                        dupBtn.type = 'button';
                        dupBtn.className = 'btn btn-sm btn-primary';
                        dupBtn.title = 'Duplikat Gambar Halaman';
                        dupBtn.onclick = () => duplicateImage(photoName);
                        dupBtn.innerHTML = '<i class="far fa-clone"></i>';

                        const delBtn = document.createElement('button');
                        delBtn.type = 'button';
                        delBtn.className = 'btn btn-sm btn-danger';
                        delBtn.title = 'Hapus Gambar';
                        delBtn.onclick = () => deleteImage(photoName);
                        delBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';


                        const cropBtn = document.createElement('button');
                        cropBtn.type = 'button';
                        cropBtn.className = 'btn btn-sm btn-primary';
                        cropBtn.innerHTML = '<i class="fas fa-crop"></i> Crop';
                        cropBtn.onclick = () => toggleCrop(photoName, cropBtn);


                        // buttonBar.appendChild(zoomBtn);
                        buttonBar.appendChild(cropBtn);
                        buttonBar.appendChild(dupBtn);
                        buttonBar.appendChild(delBtn);
                        topWrapper.appendChild(buttonBar);
                        card.appendChild(topWrapper);

                        const imgContainer = document.createElement('div');
                        const img = document.createElement('img');
                        img.src = reader.result;
                        img.alt = '';
                        img.className = 'w-100';
                        imgContainer.appendChild(img);
                        card.appendChild(imgContainer);

                        const settingsDiv = document.createElement('div');
                        settingsDiv.className = 'each-img-settings p-2 border-top';





                        // const sizeSelect = document.createElement('select');
                        // sizeSelect.id = photoName + '_size';
                        // sizeSelect.className = 'form-control form-control-sm';
                        // sizeSelect.onchange = () => resizeImage(photoName, sizeSelect.value);

                        // const sizes = [
                        //     { val: "50", label: "Persegi (Square)" }, // Square
                        //     { val: "40", label: "Pas Foto 1x2" }, // 1x2
                        //     { val: "30", label: "Pas Foto 1x3" }, // 1x3
                        //     { val: "40", label: "Pas Foto 3x1" }, // 3x1
                        //     { val: "27.9", label: "Pas Foto 2x3" }, // 2x3
                        //     { val: "38.1", label: "Pas Foto 3x4" }, // 3x4
                        //     { val: "55.9", label: "Pas Foto 4x6" }, // 4x6
                        //     { val: "160", label: "Pas Foto 9x16" }, // 9x16
                        //     { val: "90", label: "Pas Foto 16x9" }, // 16x9
                        //     { val: "88.9", label: "Foto 2R" }, // 2R
                        //     { val: "127", label: "Foto 3R" }, // 3R
                        //     { val: "152", label: "Foto 4R" }, // 4R
                        //     { val: "178", label: "Foto 5R" }, // 5R
                        //     { val: "254", label: "Foto 8R" }, // 8R
                        //     { val: "305", label: "Foto 10R" }, // 10R
                        //     { val: "420", label: "Kertas A2" }, // A2
                        //     { val: "297", label: "Kertas A3" }, // A3
                        //     { val: "280", label: "Kertas A4" }, // A4
                        //     { val: "210", label: "Kertas A4 Landscape" }, // A4 Landscape
                        //     { val: "210", label: "Kertas A5" }, // A5
                        //     { val: "52", label: "Facebook Cover" }, // Facebook Cover
                        //     { val: "63", label: "Facebook Post" } // Facebook Post
                        // ];

                        // sizes.forEach(opt => {
                        //     const option = document.createElement('option');
                        //     option.value = opt.val;
                        //     option.textContent = opt.label;
                        //     sizeSelect.appendChild(option);
                        // });

                        // const sizeWrapper = document.createElement('div');
                        // sizeWrapper.className = 'determine-related-img-size-in-preview flex-fill';
                        // sizeWrapper.appendChild(sizeSelect);
                        // settingsDiv.appendChild(sizeWrapper);




                        const amountSelect = document.createElement('select');
                        amountSelect.id = photoName + '_amount';
                        amountSelect.className = 'form-control form-control-sm';
                        amountSelect.onchange = () => amountImage(photoName, amountSelect.value);
                        amountSelect.innerHTML = numberOptions;

                        const amountWrapper = document.createElement('div');
                        amountWrapper.className = 'pt-1';
                        amountWrapper.style.minWidth = '40px';
                        amountWrapper.appendChild(amountSelect);

                        const orientationSelect = document.createElement('select');
                        orientationSelect.id = photoName + '_orientation';
                        orientationSelect.className = 'form-control form-control-sm';
                        orientationSelect.onchange = () => changeOrientation(photoName, orientationSelect.value);

                        ['portrait', 'landscape'].forEach(val => {
                            const option = document.createElement('option');
                            option.value = val;
                            option.textContent = val.charAt(0).toUpperCase() + val.slice(1);
                            orientationSelect.appendChild(option);
                        });

                        const orientationWrapper = document.createElement('div');
                        orientationWrapper.className = 'pt-1';
                        orientationWrapper.style.minWidth = '40px';
                        orientationWrapper.appendChild(orientationSelect);


                        settingsDiv.appendChild(amountWrapper);
                        settingsDiv.appendChild(orientationWrapper);
                        card.appendChild(settingsDiv);
                        container.appendChild(card);
                        document.getElementById('img-settings').appendChild(container);
                        previewPDF();
                    };
                };
            }

            function zoomImage(i) {
                modalSBoxOpenImage(photos[i].data);
            }

            function deleteImage(i) {
                showPreloader();
                delete photos[i];
                $('#' + i).css('display', 'none');
                previewPDF();
                hidePreloader();
            }

            function duplicateImage(i) {
                showPreloader();
                photoID++;
                let photoName = 'file' + photoID;
                photos[photoName] = Object.assign({}, photos[i]);
                const container = document.createElement('div');
                container.className = 'col-lg-3 col-md-4 col-6 mb-3';
                container.id = photoName;
                const card = document.createElement('div');
                card.className = 'bg-white border text-center';
                const topWrapper = document.createElement('div');
                topWrapper.className = 'position-relative';
                const buttonBar = document.createElement('div');
                buttonBar.className = 'position-absolute pt-2';
                buttonBar.style.right = '8px';

                const dupBtn = document.createElement('button');
                dupBtn.type = 'button';
                dupBtn.className = 'btn btn-sm btn-primary';
                dupBtn.title = 'Duplikat Gambar Halaman';
                dupBtn.onclick = () => duplicateImage(photoName);
                dupBtn.innerHTML = '<i class="far fa-clone"></i>';

                const cropBtn = document.createElement('button');
                cropBtn.type = 'button';
                cropBtn.className = 'btn btn-sm btn-primary';
                cropBtn.innerHTML = '<i class="fas fa-crop"></i> Crop';
                cropBtn.onclick = () => toggleCrop(photoName, cropBtn);
                buttonBar.appendChild(cropBtn);

                const delBtn = document.createElement('button');
                delBtn.type = 'button';
                delBtn.className = 'btn btn-sm btn-danger';
                delBtn.title = 'Hapus Gambar';
                delBtn.onclick = () => deleteImage(photoName);
                delBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';

                buttonBar.appendChild(dupBtn);
                buttonBar.appendChild(delBtn);
                topWrapper.appendChild(buttonBar);
                card.appendChild(topWrapper);

                const imgContainer = document.createElement('div');
                const img = document.createElement('img');
                img.src = photos[photoName].data;
                img.alt = '';
                img.className = 'w-100';
                imgContainer.appendChild(img);
                card.appendChild(imgContainer);

                const settingsDiv = document.createElement('div');
                settingsDiv.className = 'each-img-settings p-2 border-top';

                const amountSelect = document.createElement('select');
                amountSelect.id = photoName + '_amount';
                amountSelect.className = 'form-control form-control-sm';
                amountSelect.onchange = () => amountImage(photoName, amountSelect.value);
                amountSelect.innerHTML = numberOptions;

                const amountWrapper = document.createElement('div');
                amountWrapper.className = 'pt-1';
                amountWrapper.style.minWidth = '40px';
                amountWrapper.appendChild(amountSelect);

                const orientationSelect = document.createElement('select');
                orientationSelect.id = photoName + '_orientation';
                orientationSelect.className = 'form-control form-control-sm';
                orientationSelect.onchange = () => changeOrientation(photoName, orientationSelect.value);

                ['portrait', 'landscape'].forEach(val => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = val.charAt(0).toUpperCase() + val.slice(1);
                    orientationSelect.appendChild(option);
                });

                const orientationWrapper = document.createElement('div');
                orientationWrapper.className = 'pt-1';
                orientationWrapper.style.minWidth = '40px';
                orientationWrapper.appendChild(orientationSelect);

                settingsDiv.appendChild(amountWrapper);
                settingsDiv.appendChild(orientationWrapper);
                card.appendChild(settingsDiv);
                container.appendChild(card);
                document.getElementById('img-settings').appendChild(container);

                // Ensure the dropdown exists before setting its value
                const sizeDropdown = document.getElementById(photoName + '_size');
                if (sizeDropdown) {
                    sizeDropdown.value = photos[photoName].width;
                }

                document.getElementById(photoName + '_amount').value = photos[photoName].amount;
                previewPDF();
                hidePreloader();
            }

            // // function resizeImage(photoName, width) {
            // //     const height = photoHeights[width]; // Ambil height dari mapping photoHeights
            // //     photos[photoName]['width'] = width;
            // //     photos[photoName]['height'] = height; // Perbarui height
            // //     previewPDF(); // Refresh preview
            // // }


            // function resizeImage(i, v) {
            //     photos[i]['width'] = v;
            //     previewPDF();
            // }

            function resizeImage(photoName, width) {
                const height = photoHeights[width]; // Get height from mapping
                if (!width || !height) {
                    console.error(`Invalid dimensions for photo: ${photoName}. Width: ${width}, Height: ${height}`);
                    return;
                }
                photos[photoName]['width'] = width;
                photos[photoName]['height'] = height; // Update height
                previewPDF(); // Refresh preview
            }


            function amountImage(i, v) {
                photos[i]['amount'] = v;
                previewPDF();
            }

            function changeOrientation(photoName, orientation) {
                photos[photoName]['orientation'] = orientation;
                previewPDF();
            }







            // Add a variable to track the current photo line
            let currentPhotoLine = 1; // Start with line 1
            function previewPDF() {
                if (!setting) {
                    setting = {
                        paperSize: 'a4',
                        margin: 8,
                        spacing: 3,
                        line: 0
                    };
                }
                if (Object.keys(photos).length === 0) {
                    document.getElementById('previewPDF').style.display = 'none';
                    return;
                } else {
                    document.getElementById('previewPDF').style.display = 'block';
                }

                let top = 0;
                let left = 0;
                // let top = setting['margin'] ? setting['margin'] : 0;
                // let left = setting['margin'] ? setting['margin'] : 0;
                let currentHeight = 0; // Tracks the tallest image in the current row
                let maxRight = paperWidth - 2 * setting['margin'];
                let maxBottom = paperHeight - setting['margin'];
                let html = '<div class="px-2 py-1 small bg-dark text-white">PREVIEW</div>';
                html += '<div class="bg-secondary border text-center py-2" style="height:350px; overflow: auto;">';
                html += '<div style="width:210px;" class="mx-auto">';
                html += '<div class="bg-white mb-3 shadow" style="height: ' + paperHeight + 'px; padding:' + setting['margin'] + 'px;">';
                html += '<div class="border position-relative" style="height: ' + (maxBottom - setting['margin']) + 'px;">';

                let pageCount = 1; // Initialize page counter
                currentPhotoLine = 1; // Reset to the first line

                for (let x in photos) {
                    let amount = parseInt(photos[x]['amount']);
                    let width = parseInt(photos[x]['width']);
                    let height = photoHeights[photos[x]['width']];

                    // Validate dimensions
                    if (!width || !height || isNaN(width) || isNaN(height)) {
                        console.error(`Invalid dimensions for photo: ${x}. Width: ${width}, Height: ${height}`);
                        continue; // Skip this photo if dimensions are invalid
                    }

                    for (let y = 0; y < amount; y++) {
                        let imgWidth = width;
                        let imgHeight = height;
                        const MAX_WIDTH = paperWidth - 2 * setting['margin'];
                        const MAX_HEIGHT = paperHeight - 2 * setting['margin'];

                        // Scale image if needed
                        if (imgWidth > MAX_WIDTH || imgHeight > MAX_HEIGHT) {
                            let scale = Math.min(MAX_WIDTH / imgWidth, MAX_HEIGHT / imgHeight);
                            imgWidth *= scale;
                            imgHeight *= scale;
                        }

                        let right = left + (photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth);

                        // Check if the image fits in the current row
                        if (right > maxRight) {
                            // Move to the next row
                            left = 0;
                            top += currentHeight + setting['spacing']; // Use the tallest image in the row
                            currentHeight = 0; // Reset for the new row
                            currentPhotoLine++; // Increment the photo line
                        }

                        // Check if the image fits on the current page
                        if (top + imgHeight > maxBottom) {
                            // Start a new page
                            html += '</div></div>';
                            html += '<div class="bg-white mb-3 shadow" style="height: ' + paperHeight + 'px; padding:' + setting['margin'] + 'px;">';
                            html += '<div class="border position-relative" style="height: ' + (maxBottom - setting['margin']) + 'px;">';

                            top = 0;
                            left = 0;
                            currentHeight = 0;
                            pageCount++;
                            currentPhotoLine = 1; // Reset to the first line for the new page
                        }

                        // // Ensure top and left are reset when currentPhotoLine == 1
                        // if (currentPhotoLine === 1) {
                        //     top -= setting['margin'];
                        //     left = left - setting['margin'];
                        // }


                        // Add the image to the HTML
                        html += `<img src="${photos[x]['data']}" width="${imgWidth}" height="${imgHeight}"
                            style="position:absolute;
                            ${photos[x]['orientation'] === 'landscape' ? `
                            top:${top}px;
                            left:${left + (imgWidth / 2)}px;
                            transform: rotate(90deg);
                            transform-origin: ${imgWidth / 2}px ${imgWidth / 2}px;` : `
                            top:${top}px;
                            left:${left}px;`}" />`;

                        // Update `left` and `currentHeight`
                        left += (photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth) + setting['spacing'];
                        currentHeight = Math.max(currentHeight, photos[x]['orientation'] === 'landscape' ? imgWidth : imgHeight);
                    }
                }

                html += '</div></div></div></div>'; // Close all divs
                html += `
                        <div class="px-3 py-3 bg-white border d-flex justify-content-between">
                            <div>
                                <button type="button" class="btn btn-success d-none d-lg-inline-block" onclick="downloadPDF('print')">Print</button>
                                <button type="button" class="btn btn-success d-inline-block d-lg-none" onclick="modalSBoxAlert('<strong>Maaf browser ini tidak mendukung fitur print.</strong> <div>Silahkan download sebagai PDF lalu print menggunakan aplikasi atau perangkat lain.</div>')">Print</button>
                                <button type="button" class="btn btn-success" onclick="downloadPDF('download')">Download PDF</button>
                            </div>
                            <div>
                                <button type="button" class="btn btn-success" href="javascript:void(0)" data-toggle="modal" data-target="#gtModal"><span class="fa fa-cog"></span><span class="d-none d-lg-inline"> Setting</span></button>
                            </div>
                        </div>
                        <div class="text-center mt-2">Total Pages: ${pageCount}</div>
                    `;

                document.getElementById('previewPDF').innerHTML = html;
            }



            /////// V1
            // // var doc;
            // // function downloadPDF(mode) {
            // //     const doc = new jsPDF('p', 'mm', 'a4');
            // //     let top = setting['margin'];
            // //     let left = setting['margin'];
            // //     let currentHeight = 0;
            // //     const maxRight = paperWidth - setting['margin'];
            // //     const maxBottom = paperHeight - setting['margin'];

            // //     <CONTINUE HERE>


            // //     if (mode === 'download') {
            // //         const today = new Date();
            // //         const date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            // //         const time = today.getHours() + '-' + today.getMinutes();
            // //         const dateTime = date + '-' + time;
            // //         doc.save('cetak-foto-' + dateTime + '.pdf');
            // //     } else if (mode === 'print') {
            // //         doc.autoPrint();
            // //         doc.output('dataurlnewwindow');
            // //     }
            // // }

            //////// END OF V1



            // /////// V2
            // function downloadPDF(mode) {
            //     const doc = new jsPDF('p', 'mm', 'a4');
            //     let top = setting['margin'];
            //     let left = setting['margin'];
            //     let currentHeight = 0;
            //     const maxRight = paperWidth - setting['margin'];
            //     const maxBottom = paperHeight - setting['margin'];

            //     for (let x in photos) {
            //         let amount = parseInt(photos[x]['amount']);
            //         let width = parseInt(photos[x]['width']);
            //         let height = photoHeights[photos[x]['width']];

            //         // Validate dimensions
            //         if (!width || !height || isNaN(width) || isNaN(height)) {
            //             console.error(`Invalid dimensions for photo: ${x}. Width: ${width}, Height: ${height}`);
            //             continue; // Skip this photo if dimensions are invalid
            //         }

            //         for (let y = 0; y < amount; y++) {
            //             let imgWidth = width;
            //             let imgHeight = height;

            //             // Scale image if needed
            //             if (imgWidth > maxRight || imgHeight > maxBottom) {
            //                 let scale = Math.min(maxRight / imgWidth, maxBottom / imgHeight);
            //                 imgWidth *= scale;
            //                 imgHeight *= scale;
            //             }

            //             let right = left + (photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth);

            //             // Check if the image fits in the current row
            //             if (right > maxRight) {
            //                 // Move to the next row
            //                 left = setting['margin'];
            //                 top += currentHeight + setting['spacing']; // Use the tallest image in the row
            //                 currentHeight = 0; // Reset for the new row
            //             }

            //             // Check if the image fits on the current page
            //             if (top + imgHeight > maxBottom) {
            //                 // Add a new page
            //                 doc.addPage();
            //                 top = setting['margin'];
            //                 left = setting['margin'];
            //                 currentHeight = 0;
            //             }

            //             if (photos[x]['orientation'] === 'landscape'){
            //                 photoHeights = imgWidth;
            //                 photoWidths = imgHeight;
            //             }else{
            //                 photoHeights = imgHeight;
            //                 photoWidths = imgWidth;
            //             }

            //             // // Add the image to the PDF
            //             // doc.addImage(
            //             //     photos[x]['data'],
            //             //     'JPEG',
            //             //     left,
            //             //     top,
            //             //     photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth,
            //             //     photos[x]['orientation'] === 'landscape' ? imgWidth : imgHeight,
            //             //     undefined,
            //             //     'FAST'
            //             // );
            //             // Add the image to the PDF
            //             doc.addImage(
            //                 photos[x]['data'],
            //                 'JPEG',
            //                 left,
            //                 top,
            //                 photoHeights,
            //                 photoWidths,
            //                 undefined,
            //                 'FAST'
            //             );

            //             // Update `left` and `currentHeight`
            //             left += (photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth) + setting['spacing'];
            //             currentHeight = Math.max(currentHeight, photos[x]['orientation'] === 'landscape' ? imgWidth : imgHeight);
            //         }
            //     }

            //     if (mode === 'download') {
            //         const today = new Date();
            //         const date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            //         const time = today.getHours() + '-' + today.getMinutes();
            //         const dateTime = date + '-' + time;
            //         doc.save('cetak-foto-' + dateTime + '.pdf');
            //     } else if (mode === 'print') {
            //         doc.autoPrint();
            //         doc.output('dataurlnewwindow');
            //     }
            // }
            // //////// END OF V2



            // /////// V2.1
            function downloadPDF(mode) {
                const doc = new jsPDF('p', 'mm', 'a4');
                let top = setting['margin'];
                let left = setting['margin'];
                let currentHeight = 0;
                const maxRight = paperWidth - setting['margin'];
                const maxBottom = paperHeight - setting['margin'];

                for (let x in photos) {
                    let amount = parseInt(photos[x]['amount']);
                    let width = parseInt(photos[x]['width']);
                    let height = photoHeights[photos[x]['width']];

                    // Validate dimensions
                    if (!width || !height || isNaN(width) || isNaN(height)) {
                        console.error(`Invalid dimensions for photo: ${x}. Width: ${width}, Height: ${height}`);
                        continue; // Skip this photo if dimensions are invalid
                    }

                    for (let y = 0; y < amount; y++) {
                        let imgWidth = width;
                        let imgHeight = height;

                        // Scale image if needed
                        if (imgWidth > maxRight || imgHeight > maxBottom) {
                            let scale = Math.min(maxRight / imgWidth, maxBottom / imgHeight);
                            imgWidth *= scale;
                            imgHeight *= scale;
                        }

                        let right = left + (photos[x]['orientation'] === 'landscape' ? imgWidth : imgWidth);

                        // Check if the image fits in the current row
                        if (right > maxRight) {
                            // Move to the next row
                            left = setting['margin'];
                            top += currentHeight + setting['spacing']; // Use the tallest image in the row
                            currentHeight = 0; // Reset for the new row
                        }

                        // Check if the image fits on the current page
                        if (top + (photos[x]['orientation'] === 'landscape' ? imgHeight : imgHeight) > maxBottom) {  // <-- kondisional if Ini sudah saya custom ukuran sudah benar
                            // Add a new page
                            doc.addPage();
                            top = setting['margin'];
                            left = setting['margin'];
                            currentHeight = 0;
                        }

                        // Add the image to the PDF with rotation for landscape
                        if (photos[x]['orientation'] === 'landscape') {
                            doc.addImage(
                                photos[x]['data'],
                                'JPEG',
                                left + imgHeight, // Adjust left position
                                top - (imgWidth / 2) + 0.5 + setting['spacing'], // Adjust top position
                                imgWidth, // <-- Ini sudah saya custom ukuran sudah benar
                                imgHeight, //<-- Ini sudah saya custom ukuran sudah benar
                                undefined,
                                'FAST',
                                90 // Rotate 90 degrees (landscape)
                            );
                        } else {
                            doc.addImage(
                                photos[x]['data'],
                                'JPEG',
                                left,
                                top,
                                imgWidth,
                                imgHeight,
                                undefined,
                                'FAST'
                            );
                        }

                        // Update `left` and `currentHeight`
                        left += (photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth) + setting['spacing'];
                        currentHeight = Math.max(currentHeight, photos[x]['orientation'] === 'landscape' ? imgWidth : imgHeight);
                    }
                }

                if (mode === 'download') {
                    const today = new Date();
                    const date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
                    const time = today.getHours() + '-' + today.getMinutes();
                    const dateTime = date + '-' + time;
                    doc.save('cetak-foto-' + dateTime + '.pdf');
                } else if (mode === 'print') {
                    doc.autoPrint();
                    doc.output('dataurlnewwindow');
                }
            }
            // //////// END OF V2.1




            // ///// V3

            // function downloadPDF(mode) {
            //     // Initialize variables
            //     let left = setting['margin']; // Start from the left margin
            //     let top = setting['margin'];  // Start from the top margin
            //     let currentHeight = 0;        // Tracks the tallest image in the current row
            //     const maxRight = paperWidth - setting['margin'];
            //     const maxBottom = paperHeight - setting['margin'];

            //     // Create a container for the PDF content
            //     const pdfContainer = document.createElement('div');
            //     pdfContainer.style.width = '210mm'; // A4 width
            //     pdfContainer.style.height = '297mm'; // A4 height
            //     pdfContainer.style.position = 'relative';
            //     pdfContainer.style.fontFamily = 'Arial, sans-serif';

            //     // Add images to the container
            //     for (let x in photos) {
            //         let amount = parseInt(photos[x]['amount']);
            //         let width = parseInt(photos[x]['width']);
            //         let height = photoHeights[photos[x]['width']];

            //         // Validate dimensions
            //         if (!width || !height || isNaN(width) || isNaN(height)) {
            //             console.error(`Invalid dimensions for photo: ${x}. Width: ${width}, Height: ${height}`);
            //             continue; // Skip this photo if dimensions are invalid
            //         }

            //         for (let y = 0; y < amount; y++) {
            //             const img = document.createElement('img');
            //             img.src = photos[x]['data'];
            //             img.style.position = 'absolute';
            //             img.style.width = `${photos[x]['orientation'] === 'landscape' ? width : width}mm`;
            //             img.style.height = `${photos[x]['orientation'] === 'landscape' ? height : height}mm`;

            //             if (photos[x]['orientation'] === 'landscape') {
            //                 img.style.transform = 'rotate(90deg)';
            //                 img.style.transformOrigin = 'top left';
            //             }

            //             // Check if the image fits in the current row
            //             const right = left + (photos[x]['orientation'] === 'landscape' ? height : width);
            //             if (right > maxRight) {
            //                 // Move to the next row
            //                 left = setting['margin'];
            //                 top += currentHeight + setting['spacing'];
            //                 currentHeight = 0; // Reset for the new row
            //             }

            //             // Check if the image fits on the current page
            //             if (top + height > maxBottom) {
            //                 // Add a new page
            //                 const pageBreak = document.createElement('div');
            //                 pageBreak.style.pageBreakAfter = 'always';
            //                 pdfContainer.appendChild(pageBreak);

            //                 top = setting['margin'];
            //                 left = setting['margin'];
            //                 currentHeight = 0;
            //             }

            //             // Set the position of the image
            //             img.style.left = `${left}mm`;
            //             img.style.top = `${top}mm`;

            //             // Append the image to the container
            //             pdfContainer.appendChild(img);

            //             // Update position for the next image
            //             left += (photos[x]['orientation'] === 'landscape' ? height : width) + setting['spacing'];
            //             currentHeight = Math.max(currentHeight, photos[x]['orientation'] === 'landscape' ? width : height);
            //         }



            //     }

            //     // Use domPDF to generate the PDF
            //     const pdfOptions = {
            //         margin: [10, 10, 10, 10], // Top, right, bottom, left margins
            //         filename: 'cetak-foto.pdf',
            //         html2canvas: { scale: 2 }, // Higher scale for better quality
            //         jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            //     };

            //     html2pdf()
            //         .set(pdfOptions)
            //         .from(pdfContainer)
            //         .outputPdf('blob') // Generate the PDF as a Blob
            //         .then((pdfBlob) => {
            //             if (mode === 'print') {
            //                 // Open the PDF in a new tab and trigger print
            //                 const pdfUrl = URL.createObjectURL(pdfBlob);
            //                 const printWindow = window.open(pdfUrl);
            //                 printWindow.onload = function () {
            //                     printWindow.print();
            //                 };
            //             } else if (mode === 'download') {
            //                 // Save the PDF
            //                 html2pdf().set(pdfOptions).from(pdfContainer).save();
            //             }
            //         });
            // }

            // ////// END OF V3






            // //////// V4
            // function downloadPDF(mode) {
            //     const doc = new jsPDF('p', 'mm', 'a4');
            //     let top = setting['margin'];
            //     let left = setting['margin'];
            //     let currentHeight = 0;
            //     const maxRight = paperWidth - setting['margin'];
            //     const maxBottom = paperHeight - setting['margin'];

            //     for (let x in photos) {
            //         let amount = parseInt(photos[x]['amount']);
            //         let width = parseInt(photos[x]['width']);
            //         let height = photoHeights[photos[x]['width']];

            //         // Validate dimensions
            //         if (!width || !height || isNaN(width) || isNaN(height)) {
            //             console.error(`Invalid dimensions for photo: ${x}. Width: ${width}, Height: ${height}`);
            //             continue; // Skip this photo if dimensions are invalid
            //         }

            //         for (let y = 0; y < amount; y++) {
            //             let imgWidth = width;
            //             let imgHeight = height;

            //             // Scale image if needed
            //             if (imgWidth > maxRight || imgHeight > maxBottom) {
            //                 let scale = Math.min(maxRight / imgWidth, maxBottom / imgHeight);
            //                 imgWidth *= scale;
            //                 imgHeight *= scale;
            //             }

            //             let right = left + (photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth);

            //             // Check if the image fits in the current row
            //             if (right > maxRight) {
            //                 // Move to the next row
            //                 left = setting['margin'];
            //                 // top += currentHeight + setting['spacing']; // Use the tallest image in the row
            //                 top += setting['spacing']; // Use the tallest image in the row
            //                 currentHeight = 0; // Reset for the new row
            //             }

            //             // Check if the image fits on the current page
            //             if (top + imgHeight > maxBottom) {
            //                 // Add a new page
            //                 doc.addPage();
            //                 top = setting['margin'];
            //                 left = setting['margin'];
            //                 currentHeight = 0;
            //             }

            //             // Add the image to the PDF
            //             if (photos[x]['orientation'] === 'landscape') {
            //                 // Rotate and position the landscape image
            //                 doc.addImage(
            //                     photos[x]['data'],
            //                     'JPEG',
            //                     left, // Adjust left position for rotation
            //                     top,
            //                     imgWidth, // Width becomes height <-- mod: width stays width
            //                     imgHeight, // Height becomes width <-- mod: height stays height
            //                     undefined,
            //                     'FAST',
            //                     -90 // Rotate -90 degrees
            //                 );
            //             } else {
            //                 // Add the portrait image
            //                 doc.addImage(
            //                     photos[x]['data'],
            //                     'JPEG',
            //                     left,
            //                     top,
            //                     imgWidth,
            //                     imgHeight,
            //                     undefined,
            //                     'FAST'
            //                 );
            //             }

            //             // Update `left` and `currentHeight`
            //             left += (photos[x]['orientation'] === 'landscape' ? imgHeight : imgWidth) + setting['spacing'];
            //             currentHeight = Math.max(currentHeight, photos[x]['orientation'] === 'landscape' ? imgWidth : imgHeight);
            //         }
            //     }

            //     if (mode === 'download') {
            //         const today = new Date();
            //         const date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            //         const time = today.getHours() + '-' + today.getMinutes();
            //         const dateTime = date + '-' + time;
            //         doc.save('cetak-foto-' + dateTime + '.pdf');
            //     } else if (mode === 'print') {
            //         doc.autoPrint();
            //         doc.output('dataurlnewwindow');
            //     }
            // }
            // //////// END OF V4
















            // function gSetup() {
            //     if (localStorage.getItem("cetak-setting") === null) {
            //         setting = {
            //             paperSize: 'a4',
            //             margin: 8,
            //             spacing: 3,
            //             line: 0
            //         };
            //         localStorage.setItem("cetak-setting", JSON.stringify(setting));
            //     } else {
            //         let settingJSON = localStorage.getItem('cetak-setting');
            //         setting = JSON.parse(settingJSON);
            //     }
            //     for (var s in setting) {
            //         $('#setting-' + s).val(setting[s]);
            //     }
            //     setting['margin'] = parseInt(setting['margin']) || 8;
            //     setting['spacing'] = parseInt(setting['spacing']) || 3;
            //     setting['line'] = parseInt(setting['line']) || 0;
            // }


            function gSetup() {
                if (localStorage.getItem("cetak-setting") === null) {
                    // Default settings jika belum ada di localStorage
                    setting = {
                        paperSize: 'a4',
                        margin: 8,
                        spacing: 3,
                        line: 0,
                        compress: true, // Default: kompresi aktif
                        quality: 1   // Default: kualitas 100%
                    };
                    localStorage.setItem("cetak-setting", JSON.stringify(setting));
                } else {
                    // Muat pengaturan dari localStorage
                    let settingJSON = localStorage.getItem('cetak-setting');
                    setting = JSON.parse(settingJSON);

                    // Validasi properti yang diperlukan
                    setting = {
                        paperSize: setting.paperSize || 'a4',
                        margin: parseInt(setting.margin) || 8,
                        spacing: parseInt(setting.spacing) || 3,
                        line: parseInt(setting.line) || 0,
                        compress: setting.compress !== undefined ? setting.compress : true,
                        quality: parseFloat(setting.quality) || 1
                    };
                }

                // Terapkan pengaturan ke elemen input
                $('#setting-compress').prop('checked', setting.compress); // Terapkan ke checkbox
                $('#setting-quality').val(setting.quality); // Terapkan ke dropdown kualitas
                $('#setting-margin').val(setting.margin);
                $('#setting-spacing').val(setting.spacing);
                $('#setting-line').val(setting.line);

                // Tambahkan event listener onchange untuk menyimpan pengaturan secara otomatis
                $('#setting-compress').on('change', gSettingSave);
                $('#setting-quality').on('change', gSettingSave);
                $('#setting-margin').on('change', gSettingSave);
                $('#setting-spacing').on('change', gSettingSave);
                $('#setting-line').on('change', gSettingSave);
            }
            // gSetup();

            // function gSettingSave() {
            //     for (var s in setting) {
            //         setting[s] = $('#setting-' + s).val();
            //     }
            //     setting['margin'] = parseInt($('#setting-margin').val()) || 8;
            //     setting['spacing'] = parseInt($('#setting-spacing').val()) || 3;
            //     setting['line'] = parseInt($('#setting-line').val()) || 0;
            //     localStorage.setItem("cetak-setting", JSON.stringify(setting));
            //     $('#gtModal').modal('hide');
            //     previewPDF();
            // }



            // function gSettingSave() {
            //     for (var s in setting) {
            //         setting[s] = $('#setting-' + s).val();
            //     }
            //     setting['margin'] = parseInt($('#setting-margin').val()) || 0; // Pastikan margin diatur ke 0 jika tidak ada nilai
            //     setting['spacing'] = parseInt($('#setting-spacing').val()) || 3;
            //     setting['line'] = parseInt($('#setting-line').val()) || 0;
            //     console.log('Updated settings:', setting); // Debugging
            //     localStorage.setItem("cetak-setting", JSON.stringify(setting));
            //     previewPDF(); // Pastikan preview diperbarui
            //     $('#gtModal').modal('hide');
            // }


            function gSettingSave() {
                console.log('gSettingSave triggered'); // Debugging log
                setting.compress = $('#setting-compress').is(':checked'); // Ambil nilai checkbox
                setting.quality = parseFloat($('#setting-quality').val()) || 1; // Ambil nilai kualitas
                setting.margin = parseInt($('#setting-margin').val()) || 0; // Pastikan margin diatur ke 0 jika tidak ada nilai
                setting.spacing = parseInt($('#setting-spacing').val()) || 0;
                setting.line = parseInt($('#setting-line').val()) || 0;

                // Simpan ke localStorage
                localStorage.setItem("cetak-setting", JSON.stringify(setting));

                // Terapkan pengaturan ke gambar yang sudah diunggah jika kompresi diaktifkan
                if (setting.compress) {
                    applySettingsToUploadedPhotos();
                }

                // Refresh preview
                previewPDF();

                // Tutup modal
                $('#gtModal').modal('hide');
            }


            function applySettingsToUploadedPhotos() {
                if (!setting.compress) return; // Jika kompresi tidak diaktifkan, keluar dari fungsi

                const photoKeys = Object.keys(photos);
                const compressedPhotosPromises = photoKeys.map((key) => {
                    const originalData = photos[key].originalData || photos[key].data; // Gunakan data asli jika tersedia
                    return compressImage(dataURLtoFile(originalData, `${key}.jpg`), 10, setting.quality)
                        .then((compressedFile) => {
                            const reader = new FileReader();
                            reader.readAsDataURL(compressedFile);
                            return new Promise((resolve) => {
                                reader.onload = function () {
                                    photos[key].data = reader.result; // Perbarui data gambar
                                    resolve();
                                };
                            });
                        });
                });

                Promise.all(compressedPhotosPromises).then(() => {
                    previewPDF(); // Refresh preview setelah semua gambar diperbarui
                });
            }

            // Fungsi untuk mengonversi data URL ke file
            function dataURLtoFile(dataurl, filename) {
                const arr = dataurl.split(',');
                const mime = arr[0].match(/:(.*?);/)[1];
                const bstr = atob(arr[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                while (n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                return new File([u8arr], filename, { type: mime });
            }
        </script>
    </div>


    <div class="modal fade" id="gtModal" tabindex="-1" role="dialog" aria-labelledby="gtModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="gtModalLabel">Setting</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <div class="modal-body bg-light" id="gtModalBody">
                    <div class="row">
                        <div class="col-lg-3 col-md-6">
                            <label for="setting-paperSize">Ukuran Kertas</label>
                            <div>
                                <select id="setting-paperSize" class="form-control form-control-sm">
                                    <option value="a4" selected="selected">A4 - 210 x 297 mm</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <label for="setting-margin">Margin</label>
                            <div>
                                <select id="setting-margin" class="form-control form-control-sm">
                                    <option value="0">0 mm</option>
                                    <option value="1">1 mm</option>
                                    <option value="5">5 mm</option>
                                    <option value="8" selected="selected">8 mm</option>
                                    <option value="10">10 mm</option>
                                    <option value="15">15 mm</option>
                                    <option value="20">20 mm</option>
                                    <option value="25">25 mm</option>
                                    <option value="30">30 mm</option>
                                    <option value="35">35 mm</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <label for="setting-spacing">Spacing</label>
                            <div>
                                <select id="setting-spacing" class="form-control form-control-sm">
                                    <option value="0">0 mm</option>
                                    <option value="1">1 mm</option>
                                    <option value="2">2 mm</option>
                                    <option value="3" selected="selected">3 mm</option>
                                    <option value="4">4 mm</option>
                                    <option value="5">5 mm</option>
                                    <option value="6">6 mm</option>
                                    <option value="7">7 mm</option>
                                    <option value="8">8 mm</option>
                                    <option value="9">9 mm</option>
                                    <option value="10">10 mm</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <label for="setting-line">Tampilan Foto</label>
                            <div>
                                <select id="setting-line" class="form-control form-control-sm">
                                    <option value="0" selected="selected">Hemat Kertas</option>
                                    <option value="1">Foto Baru Baris Baru</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6">
                            <label for="setting-quality">Kualitas Gambar</label>
                            <div>
                                <select id="setting-quality" class="form-control form-control-sm">
                                    <option value="0.1">10%</option>
                                    <option value="0.3">30%</option>
                                    <option value="0.5">50%</option>
                                    <option value="0.7" selected="selected">70%</option>
                                    <option value="0.9">90%</option>
                                    <option value="1">100%</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6">
                            <label for="setting-compress">Kompresi Gambar</label>
                            <div class="form-check">
                                <input type="checkbox" id="setting-compress" class="form-check-input">
                                <label class="form-check-label" for="setting-compress">Aktifkan Kompresi</label>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <!-- <button type="button" class="btn btn-success" onclick="gSettingSave()"><span
                            class="fas fa-check mr-1"></span> Simpan</button> -->
                    <button type="button" class="btn btn-dark" data-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        modalSBoxSetup();
    </script>




    <script>
        const aspectRatioDimensions = {
            "none": { label: "Free", ratio: NaN, width: null, height: null, sizes: null, photoHeight: null }, // Free aspect ratio
            "1": { label: "Persegi (Square)", ratio: 1, width: 50, height: 50, sizes: "50", photoHeight: "50" }, // Persegi (Square)
            "2": { label: "Pas Foto 1x2", ratio: 1 / 2, width: 20, height: 40, sizes: "20", photoHeight: "40" }, // 1x2
            "3": { label: "Pas Foto 1x3", ratio: 1 / 3, width: 10, height: 30, sizes: "10", photoHeight: "30" }, // 1x3
            "4": { label: "Pas Foto 3x1", ratio: 3, width: 120, height: 40, sizes: "120", photoHeight: "40" }, // 3x1
            "5": { label: "Pas Foto 2x3", ratio: 2 / 3, width: 21.6, height: 27.9, sizes: "21.6", photoHeight: "27.9" }, // Pas Foto 2x3
            "6": { label: "Pas Foto 3x4", ratio: 3 / 4, width: 27.9, height: 38.1, sizes: "27.9", photoHeight: "38.1" }, // Pas Foto 3x4
            "7": { label: "Pas Foto 4x6", ratio: 4 / 6, width: 38.1, height: 55.9, sizes: "38.1", photoHeight: "55.9" }, // Pas Foto 4x6
            "8": { label: "Pas Foto 9x16", ratio: 9 / 16, width: 90, height: 160, sizes: "90", photoHeight: "160" }, // 9x16
            "9": { label: "Pas Foto 16x9", ratio: 16 / 9, width: 160, height: 90, sizes: "160", photoHeight: "90" }, // 16x9

            "10": { label: "Foto 2R", ratio: 2 / 3, width: 63.5, height: 88.9, sizes: "63.5", photoHeight: "88.9" }, // Foto 2R
            "11": { label: "Foto 3R", ratio: 2 / 3, width: 89, height: 127, sizes: "89", photoHeight: "127" }, // Foto 3R
            "12": { label: "Foto 4R", ratio: 2 / 3, width: 102, height: 152, sizes: "102", photoHeight: "152" }, // Foto 4R
            "13": { label: "Foto 5R", ratio: 2 / 3, width: 127, height: 178, sizes: "127", photoHeight: "178" }, // Foto 5R
            "14": { label: "Foto 8R", ratio: 4 / 5, width: 203, height: 254, sizes: "203", photoHeight: "254" }, // Foto 8R
            "15": { label: "Foto 10R", ratio: 4 / 5, width: 254, height: 305, sizes: "254", photoHeight: "305" }, // Foto 10R


            "16": { label: "Kertas A2", ratio: 594 / 420, width: 594, height: 420, sizes: "594", photoHeight: "420" }, // Kertas A2
            "17": { label: "Kertas A3", ratio: 420 / 297, width: 420, height: 297, sizes: "420", photoHeight: "297" }, // Kertas A3
            "18": { label: "Kertas A4", ratio: 210 / 297, width: 193, height: 280, sizes: "193", photoHeight: "280" }, // Kertas A4
            "19": { label: "Kertas A4 Landscape", ratio: 297 / 210, width: 297, height: 210, sizes: "297", photoHeight: "210" }, // Kertas A4 Landscape
            "20": { label: "Kertas A5", ratio: 148 / 210, width: 148, height: 210, sizes: "148", photoHeight: "210" }, // Kertas A5

            "21": { label: "Facebook Cover", ratio: 1.91, width: 100, height: 52, sizes: "100", photoHeight: "52" }, // Facebook Cover
            "22": { label: "Facebook Post", ratio: 1.91, width: 120, height: 63, sizes: "120", photoHeight: "63" }, // Facebook Post
        };

        const aspectRatioSelect = document.getElementById('aspectRatioSelect');
        // Clear existing options
        aspectRatioSelect.innerHTML = '';
        Object.keys(aspectRatioDimensions).forEach(key => {
            const { label } = aspectRatioDimensions[key];
            if (label) { // Ensure valid entries
                const option = document.createElement('option');
                option.value = key;
                option.textContent = label;
                aspectRatioSelect.appendChild(option);
            }
        });



        function toggleCrop(photoName, cropBtn) {
            if (cropBtn.dataset.mode === 'uncrop') {
                // Uncrop the image
                if (photos[photoName] && photos[photoName].originalData) {
                    photos[photoName].data = photos[photoName].originalData;

                    // Update the image in the gallery
                    const imgElement = document.querySelector(`#${photoName} img`);
                    imgElement.src = photos[photoName].originalData;

                    // Reset size to original
                    imgElement.style.width = 'auto';
                    imgElement.style.height = 'auto';

                    // Reset the dropdown size
                    const sizeSelect = document.getElementById(`${photoName}_size`);
                    if (sizeSelect) {
                        sizeSelect.value = ''; // Reset dropdown
                    }

                    // Refresh the PDF preview
                    previewPDF();

                    // Switch back to crop mode
                    cropBtn.dataset.mode = 'crop';
                    cropBtn.innerHTML = '<i class="fas fa-crop"></i> Crop';
                } else {
                    console.error('Original image data not found.');
                }
            } else {
                // Enable crop mode
                enableCropMode(photoName, cropBtn);
            }
        }






        function enableCropMode(photoName, cropBtn) {
            showPreloader();
            const imageData = photos[photoName].data;
            document.getElementById('cropImage').src = imageData;
            $('#cropModal').modal('show'); // Show the crop modal
            hidePreloader();

            // Initialize Cropper.js when the modal is shown
            $('#cropModal').off('shown.bs.modal').on('shown.bs.modal', function () {
                const image = document.getElementById('cropImage');
                cropper = new Cropper(image, {
                    aspectRatio: NaN, // Default to free aspect ratio
                    viewMode: 1,
                    movable: true,
                    zoomable: true,
                    rotatable: true,
                    scalable: true,
                    ready() {
                        // Apply the selected aspect ratio on initialization
                        const selectedAspectRatio = document.getElementById('aspectRatioSelect').value;
                        const aspectRatio = parseFloat(aspectRatioDimensions[selectedAspectRatio]?.ratio || NaN);
                        cropper.setAspectRatio(aspectRatio);
                    }
                });

                // Update aspect ratio dynamically
                document.getElementById('aspectRatioSelect').addEventListener('change', function () {
                    const selectedAspectRatio = this.value;
                    const aspectRatio = parseFloat(aspectRatioDimensions[selectedAspectRatio]?.ratio || NaN);
                    cropper.setAspectRatio(aspectRatio);

                    // Log for debugging
                    console.log('Selected Aspect Ratio:', selectedAspectRatio);
                    console.log('Applied Aspect Ratio:', aspectRatio);
                });

                // Confirm crop and update the image
                document.getElementById('confirmCrop').onclick = function () {
                    const canvas = cropper.getCroppedCanvas();

                    if (!canvas || canvas.width === 0 || canvas.height === 0) {
                        console.error('Invalid cropped canvas dimensions.');
                        return;
                    }

                    const croppedImage = canvas.toDataURL('image/jpeg');
                    photos[photoName].data = croppedImage; // Update the photo data

                    // Get the selected aspect ratio
                    const selectedAspectRatio = document.getElementById('aspectRatioSelect').value;

                    // Validate sizes before calling resizeImage
                    if (aspectRatioDimensions[selectedAspectRatio]) {
                        const { sizes } = aspectRatioDimensions[selectedAspectRatio];
                        if (sizes) {
                            resizeImage(photoName, sizes); // Update dimensions and refresh preview
                        } else {
                            console.error(`Invalid sizes for aspect ratio: ${selectedAspectRatio}`);
                        }
                    } else {
                        // Default to the cropped canvas dimensions
                        photos[photoName].width = canvas.width;
                        photos[photoName].height = canvas.height;

                        // Call resizeImage with the cropped dimensions
                        resizeImage(photoName, canvas.width);
                    }

                    // Switch the crop button to uncrop mode
                    cropBtn.dataset.mode = 'uncrop';
                    cropBtn.innerHTML = '<i class="fas fa-undo"></i> Uncrop';

                    $('#cropModal').modal('hide');
                };
            });

            // Destroy Cropper.js when the modal is hidden
            $('#cropModal').off('hidden.bs.modal').on('hidden.bs.modal', function () {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
            });
        }






    </script>



</body>

</html>
